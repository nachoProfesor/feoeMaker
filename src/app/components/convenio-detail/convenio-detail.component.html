<div class="convenio-container">
  <div class="convenio-header">
    <button class="btn-secondary btn-back" (click)="volver()">Volver</button>
    <h1>Convenio</h1>
  </div>

  <div *ngIf="cargando" class="loading">Cargando datos de la empresa...</div>

  <div *ngIf="!cargando && empresa" class="empresa-detail">
    <h2 class="empresa-nombre">{{ empresa.nombre_empr }}</h2>
    <div class="detail-grid">
      <div><strong>CIF:</strong> {{ empresa.cif_empr || '-' }}</div>
      <div><strong>Dirección:</strong> {{ empresa.calle_empr || '-' }}</div>
      <div><strong>Código postal:</strong> {{ empresa.cod_postal_empr || '-' }}</div>
      <div><strong>Localidad / Provincia:</strong> {{ empresa.localidad_empr || '-' }}{{ empresa.provincia_empr ? (' / ' + empresa.provincia_empr) : '' }}</div>
      <div><strong>Teléfono:</strong> {{ empresa.telefono_empr || '-' }}</div>
      <div><strong>Email:</strong> {{ empresa.correo_empr || '-' }}</div>
      <div><strong>Representante:</strong> {{ empresa.nombre_repr || '-' }} {{ empresa.apellidos_repr || '' }}</div>
      <div><strong>DNI representante:</strong> {{ empresa.dni_repr || '-' }}</div>
      <div><strong>Número de convenio:</strong> {{ empresa.numero_convenio || '-' }}</div>
      <div><strong>Fecha firma:</strong> {{ empresa.fecha_firma_conv || '-' }}</div>
    </div>

    <div class="actions">
      <button class="btn-doc btn-primary" (click)="generarAnexoX()" title="Generar anexo X">
        <svg class="icon-doc" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8" d="M8 2h6l6 6v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8" d="M14 2v6h6"/></svg>
        <span>Generar anexo X</span>
      </button>

      <button class="btn-doc btn-outline" (click)="toggleAnexoIIIForm()" title="Generar anexo III">
        <svg class="icon-doc" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8" d="M21 15v4a1 1 0 0 1-1 1H6a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h9"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8" d="M17 21V8l-5 4-5-4v13"/></svg>
        <span>Generar anexo III</span>
      </button>
    </div>

    <div *ngIf="showAnexoIIIForm" class="anexo-form">
      <h3>Generar Anexo III</h3>
      <div class="form-row">
        <label for="anexo-num">Número de convenio</label>
        <input id="anexo-num" type="text" [(ngModel)]="anexoIIINumero" placeholder="10006600-XXX" />
        <small class="hint">Formato esperado: 8 dígitos, guion, 3 caracteres (ej. 10006600-ABC)</small>
      </div>
      <div class="form-row">
        <label for="anexo-fecha">Fecha</label>
        <input id="anexo-fecha" type="date" [(ngModel)]="anexoIIIFecha" />
        <small class="hint">Selecciona la fecha (se mostrará como dd-mm-yyyy)</small>
      </div>

      <div class="form-actions">
        <button class="btn-doc btn-primary" [disabled]="!isAnexoIIIValid()" (click)="generarAnexoIIIProceed()">Generar documento</button>
        <button class="btn-doc btn-outline" (click)="cancelAnexoIII()">Cancelar</button>
      </div>
    </div>
  </div>

  <div *ngIf="!cargando && !empresa" class="empty-state">
    <h3>Empresa no encontrada</h3>
    <p>No se ha podido localizar la empresa solicitada.</p>
    <button class="btn-secondary" (click)="volver()">Volver a empresas</button>
  </div>
</div>
