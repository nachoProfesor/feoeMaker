<div class="empresas-container">
  <div class="header">
    <div>
      <h1 class="title">Empresas</h1>
      <p class="subtitle">Gestión de empresas colaboradoras</p>
    </div>
    <button class="btn-primary" (click)="abrirModal()">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
      </svg>
      Nueva Empresa
    </button>
  </div>

  <!-- Buscador -->
  <div class="search-container">
    <div class="search-box">
      <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg>
      <input 
        type="text" 
        class="search-input" 
        placeholder="Buscar por nombre, CIF, localidad, provincia o representante..."
        [(ngModel)]="filtroTexto"
        (input)="filtrarEmpresas()"
      >
      <button *ngIf="filtroTexto" class="clear-btn" (click)="limpiarFiltro()">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="18" height="18">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
    <div class="search-results" *ngIf="filtroTexto">
      Mostrando {{ empresasFiltradas.length }} de {{ empresas.length }} empresas
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading">
    <p>Cargando empresas...</p>
  </div>

  <!-- Lista de empresas -->
  <div *ngIf="!loading" class="empresas-list">
    <div *ngFor="let empresa of empresasFiltradas" class="empresa-item">
      <div class="empresa-info">
        <div class="empresa-main">
          <h3 class="empresa-nombre">{{ empresa.nombre_empr }}</h3>
          <span class="empresa-cif" *ngIf="empresa.cif_empr">CIF: {{ empresa.cif_empr }}</span>
        </div>
        <div class="empresa-details">
          <span *ngIf="empresa.localidad_empr || empresa.provincia_empr" class="detail-item">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="14" height="14">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            {{ empresa.localidad_empr }}{{ empresa.provincia_empr ? ', ' + empresa.provincia_empr : '' }}
          </span>
          <span *ngIf="empresa.telefono_empr" class="detail-item">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="14" height="14">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
            </svg>
            {{ empresa.telefono_empr }}
          </span>
          <span *ngIf="empresa.correo_empr" class="detail-item">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="14" height="14">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
            </svg>
            {{ empresa.correo_empr }}
          </span>
          <span *ngIf="empresa.nombre_repr" class="detail-item representante">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="14" height="14">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
            {{ empresa.nombre_repr }} {{ empresa.apellidos_repr }}
          </span>
        </div>
      </div>
      <div class="empresa-actions">
        <button class="btn-icon btn-edit" (click)="editarEmpresa(empresa)" title="Editar">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="18" height="18">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
          </svg>
        </button>
        <button class="btn-icon btn-delete" (click)="eliminarEmpresa(empresa)" title="Eliminar">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="18" height="18">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
          </svg>
        </button>
        <button class="btn-convenio" (click)="abrirConvenio(empresa)" title="Ver/Crear convenio">
          <svg class="icon-handshake" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8" d="M21 15v4a1 1 0 0 1-1 1h-3M3 9v-2a1 1 0 0 1 1-1h2m12 8-4-4m0 0-7-1 1 7 7 1 3-3z" />
          </svg>
          <span>convenio</span>
        </button>
      </div>
    </div>

    <!-- Mensaje si no hay empresas -->
    <div *ngIf="empresasFiltradas.length === 0 && !filtroTexto" class="empty-state">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="48" height="48">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
      </svg>
      <h3>No hay empresas registradas</h3>
      <p>Comienza añadiendo una nueva empresa</p>
    </div>

    <!-- Mensaje si no hay resultados de búsqueda -->
    <div *ngIf="empresasFiltradas.length === 0 && filtroTexto" class="empty-state">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="48" height="48">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg>
      <h3>No se encontraron resultados</h3>
      <p>No hay empresas que coincidan con "{{ filtroTexto }}"</p>
      <button class="btn-secondary" (click)="limpiarFiltro()">Limpiar búsqueda</button>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal-overlay" *ngIf="mostrarModal" (click)="cerrarModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ empresaEditando ? 'Editar Empresa' : 'Nueva Empresa' }}</h2>
        <button class="btn-close" (click)="cerrarModal()">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="24" height="24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      
      <form [formGroup]="empresaForm" (ngSubmit)="guardarEmpresa()" class="modal-body">
        <h3 class="section-title">Datos de la Empresa</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="nombre_empr">Nombre de la Empresa *</label>
            <input id="nombre_empr" type="text" formControlName="nombre_empr" placeholder="Nombre completo">
          </div>
          <div class="form-group">
            <label for="cif_empr">CIF</label>
            <input id="cif_empr" type="text" formControlName="cif_empr" placeholder="A12345678">
          </div>
          <div class="form-group">
            <label for="provincia_empr">Provincia</label>
            <input id="provincia_empr" type="text" formControlName="provincia_empr" placeholder="Provincia">
          </div>
          <div class="form-group">
            <label for="localidad_empr">Localidad</label>
            <input id="localidad_empr" type="text" formControlName="localidad_empr" placeholder="Localidad">
          </div>
          <div class="form-group">
            <label for="calle_empr">Dirección</label>
            <input id="calle_empr" type="text" formControlName="calle_empr" placeholder="Calle, número">
          </div>
          <div class="form-group">
            <label for="cod_postal_empr">Código Postal</label>
            <input id="cod_postal_empr" type="text" formControlName="cod_postal_empr" placeholder="10600">
          </div>
          <div class="form-group">
            <label for="telefono_empr">Teléfono</label>
            <input id="telefono_empr" type="tel" formControlName="telefono_empr" placeholder="927123456">
          </div>
          <div class="form-group">
            <label for="correo_empr">Email</label>
            <input id="correo_empr" type="email" formControlName="correo_empr" placeholder="empresa@ejemplo.com">
          </div>
        </div>

        <h3 class="section-title">Datos del Representante</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="nombre_repr">Nombre</label>
            <input id="nombre_repr" type="text" formControlName="nombre_repr" placeholder="Nombre">
          </div>
          <div class="form-group">
            <label for="apellidos_repr">Apellidos</label>
            <input id="apellidos_repr" type="text" formControlName="apellidos_repr" placeholder="Apellidos">
          </div>
          <div class="form-group">
            <label for="dni_repr">DNI</label>
            <input id="dni_repr" type="text" formControlName="dni_repr" placeholder="12345678A">
          </div>
        </div>

        <h3 class="section-title">Datos del Convenio</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="numero_convenio">Número de Convenio</label>
            <input id="numero_convenio" type="number" formControlName="numero_convenio" placeholder="123">
          </div>
          <div class="form-group">
            <label for="fecha_firma_conv">Fecha de Firma</label>
            <input id="fecha_firma_conv" type="date" formControlName="fecha_firma_conv">
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn-secondary" (click)="cerrarModal()">Cancelar</button>
          <button type="submit" class="btn-primary" [disabled]="!empresaForm.valid || guardando">
            {{ guardando ? 'Guardando...' : (empresaEditando ? 'Actualizar Empresa' : 'Guardar Empresa') }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
